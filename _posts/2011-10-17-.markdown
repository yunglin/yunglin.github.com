---
layout: post
title: "台北市政府公開資料（二）- 按地理位址搜尋資料"
date: 2011-10-17T20:29:00-07:00
comments: false
---

<div class='post'>
多數的搜尋技術，在處理地理位址時，只處理地點的資料，例如餐廳、百貨公司等小地理區塊等，但是這些地點搜詢技術，並不適合用在處理大區塊範圍的資料，如行政區及學區等。<br /><div><br /></div><div>如多數外國網站用的坐標轉行政區的GeoNames，他在搜尋某個座標目前所屬的行政區時，是計算座標點與附近行政區中心的距離來猜測，但是行政區往往不是正圓型的，行政區的劃分多是依自然環境（如河川）來切割的，所以，既始某個座標離行政區甲較近，但是，在實務上則是被劃分到乙行政區去的；類似的例子還有學區等</div><div><br /></div><div>另一類無法用點去描述 的，是線型的資料，如登山步道、腳踏車道，當我們登山時，我們不一定要從起點開始爬，而是可以從中間點開始加入，因此，當我們在找附近所有的登山步道時，該是計算所有線型資料與目前座標點的最短距離，而非是算起點與目前座標點的距離。</div><div><br /></div><div>依據了這套需求，我在我公司的產品上增加了對地理區塊搜尋的功能，讓用戶能對點(Point)、線(LineString)，多邊型(Polygon)等資料，做搜尋。</div><div><br /></div><div>底下的連結，是搜詢台北101大樓所在的行政區，大家可以玩玩看</div><div><br /></div><div><a href="http://api.test.sccld.com/rest/1.0/model/bluetang_taipeidistricts/search/?f=geometry:25.033611,121.565,1m&amp;key=feec379d0f91408b84b2f6f08ecdd384&amp;count=1&amp;fl=properties">http://api.test.sccld.com/rest/1.0/model/bluetang_taipeidistricts/search/?f=geometry:25.033611,121.565,1m&amp;key=feec379d0f91408b84b2f6f08ecdd384&amp;count=1&amp;fl=properties</a></div><div><br /></div><div><span class="Apple-style-span" style="color: #444444; font-family: monospace, mono, consolas; font-size: 13px; line-height: 18px;"><span class="b" style="font-weight: bold;">{</span><span class="ell"></span><span class="blockInner" style="border-left-color: rgb(187, 187, 187); border-left-style: dotted; border-left-width: 1px; display: block; margin-left: 2px; padding-left: 24px;"><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;"><span class="e"></span>"<span class="k" style="color: black;">results</span>":&nbsp;<span class="b" style="font-weight: bold;">[</span><span class="ell"></span><span class="blockInner" style="border-left-color: rgb(187, 187, 187); border-left-style: dotted; border-left-width: 1px; display: block; margin-left: 2px; padding-left: 24px;"><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;"><span class="e"></span><span class="b" style="font-weight: bold;">{</span><span class="ell"></span><span class="blockInner" style="border-left-color: rgb(187, 187, 187); border-left-style: dotted; border-left-width: 1px; display: block; margin-left: 2px; padding-left: 24px;"><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">id</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">302</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;"><span class="e"></span>"<span class="k" style="color: black;">properties</span>":&nbsp;<span class="b" style="font-weight: bold;">{</span><span class="ell"></span><span class="blockInner" style="border-left-color: rgb(187, 187, 187); border-left-style: dotted; border-left-width: 1px; display: block; margin-left: 2px; padding-left: 24px;"><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">AREA</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">522872.00372</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">NEW</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">6300200001</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">FULL</span>":&nbsp;<span class="s" style="color: #0b7500; word-wrap: break-word;">"臺北市信義區西村里"</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">PERF_ID</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">63002</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">COUN_ID</span>":&nbsp;<span class="s" style="color: #0b7500; word-wrap: break-word;">"6300200"</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">CPID</span>":&nbsp;<span class="s" style="color: #0b7500; word-wrap: break-word;">"63002"</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">CPTID</span>":&nbsp;<span class="s" style="color: #0b7500; word-wrap: break-word;">"6300200"</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">CPTVID</span>":&nbsp;<span class="s" style="color: #0b7500; word-wrap: break-word;">"6300200001"</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">NPID</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">63002</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">NPTID</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">6300200</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">NPTVID</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">6300200001</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">PNAME</span>":&nbsp;<span class="s" style="color: #0b7500; word-wrap: break-word;">"臺北市"</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">TNAME</span>":&nbsp;<span class="s" style="color: #0b7500; word-wrap: break-word;">"信義區"</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">VNAME</span>":&nbsp;<span class="s" style="color: #0b7500; word-wrap: break-word;">"西村里"</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">PTVNAME</span>":&nbsp;<span class="s" style="color: #0b7500; word-wrap: break-word;">"臺北市信義區西村里"</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">PTNAME</span>":&nbsp;<span class="s" style="color: #0b7500; word-wrap: break-word;">"臺北市信義區"</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">TVNAME</span>":&nbsp;<span class="s" style="color: #0b7500; word-wrap: break-word;">"信義區西村里"</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">TM2_MAX_X</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">306528.415</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">TM2_MAX_Y</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">2770435.21</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">TM2_MIN_X</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">305428.311</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">TM2_MIN_Y</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">2769739.57</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">MAX_X</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">0</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">MAX_Y</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">0</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">MIN_X</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">0</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">MIN_Y</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">0</span></span></span><span class="b" style="font-weight: bold;">}</span></span></span><span class="b" style="font-weight: bold;">}</span></span></span><span class="b" style="font-weight: bold;">]</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;"><span class="e"></span>"<span class="k" style="color: black;">metadata</span>":&nbsp;<span class="b" style="font-weight: bold;">{</span><span class="ell"></span><span class="blockInner" style="border-left-color: rgb(187, 187, 187); border-left-style: dotted; border-left-width: 1px; display: block; margin-left: 2px; padding-left: 24px;"><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;"><span class="e"></span>"<span class="k" style="color: black;">searchQuery</span>":&nbsp;<span class="b" style="font-weight: bold;">{</span><span class="ell"></span><span class="blockInner" style="border-left-color: rgb(187, 187, 187); border-left-style: dotted; border-left-width: 1px; display: block; margin-left: 2px; padding-left: 24px;"><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">queries</span>":&nbsp;<span class="b" style="font-weight: bold;">[</span><span class="b" style="font-weight: bold;">]</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;"><span class="e"></span>"<span class="k" style="color: black;">constraints</span>":&nbsp;<span class="b" style="font-weight: bold;">[</span><span class="ell"></span><span class="blockInner" style="border-left-color: rgb(187, 187, 187); border-left-style: dotted; border-left-width: 1px; display: block; margin-left: 2px; padding-left: 24px;"><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;"><span class="e"></span><span class="b" style="font-weight: bold;">{</span><span class="ell"></span><span class="blockInner" style="border-left-color: rgb(187, 187, 187); border-left-style: dotted; border-left-width: 1px; display: block; margin-left: 2px; padding-left: 24px;"><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">@type</span>":&nbsp;<span class="s" style="color: #0b7500; word-wrap: break-word;">"location"</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">field</span>":&nbsp;<span class="s" style="color: #0b7500; word-wrap: break-word;">"geometry"</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">location</span>":&nbsp;<span class="s" style="color: #0b7500; word-wrap: break-word;">"25.033611,121.565"</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">radius</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">1</span></span></span><span class="b" style="font-weight: bold;">}</span></span></span><span class="b" style="font-weight: bold;">]</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;"><span class="e"></span>"<span class="k" style="color: black;">pagination</span>":&nbsp;<span class="b" style="font-weight: bold;">{</span><span class="ell"></span><span class="blockInner" style="border-left-color: rgb(187, 187, 187); border-left-style: dotted; border-left-width: 1px; display: block; margin-left: 2px; padding-left: 24px;"><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">start</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">0</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">count</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">1</span></span></span><span class="b" style="font-weight: bold;">}</span></span></span><span class="b" style="font-weight: bold;">}</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">start</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">0</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">count</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">1</span>,</span><span class="kvov" style="display: block; margin-left: -20px; padding-left: 20px; position: relative;">"<span class="k" style="color: black;">total</span>":&nbsp;<span class="n" style="color: #1a01cc; font-weight: bold;">1</span></span></span><span class="b" style="font-weight: bold;">}</span></span></span><span class="b" style="font-weight: bold;">}</span></span></div></div>
