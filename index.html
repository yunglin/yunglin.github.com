
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>碎碎唸</title>
  <meta name="author" content="">

  
  <meta name="description" content="最近在讀 Implementing Domain-Driven Design 這本書，學習一下別人
是怎麼整理好整個大型軟的架構，並且重新檢視一下我們公司的程式碼的問題。 在 DDD 的概念中，一個模組 Domain / Bounded Context 應該是一個獨立的關念，一個大型程式， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://blog.yunglinho.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/yunglinho" rel="alternate" title="碎碎唸" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-11857878-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">碎碎唸</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/yunglinho" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:blog.yunglinho.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/04/23/type-inference-and-code-review/">Type Inference 在實務上碰上的問題</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-04-23T23:36:00+08:00" pubdate data-updated="true">Apr 23<span>rd</span>, 2015</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近在讀 <strong>Implementing Domain-Driven Design</strong> 這本書，學習一下別人
是怎麼整理好整個大型軟的架構，並且重新檢視一下我們公司的程式碼的問題。</p>

<p>在 DDD 的概念中，一個模組 <strong>Domain</strong> / <strong>Bounded Context</strong>  應該是一個獨立的關念，一個大型程式，應該是由許多 <strong>Bounded Context</strong> 組合而成，整個程式的架構應該僅量保持這些的純淨性，<strong>Bounded Context</strong> 的互用，要把上下行的關係定意清處，程式碼間不應該在一個區塊中引入多個 <strong>Bounded Context</strong>。</p>

<p>在整實作上，如合檢視一個 class 是否有妥善的處理引用入的 <strong>Domain</strong> ，最簡單也最好用的方式就是看檔頭 <strong>import</strong> 的地方</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import com.codahale.metrics.Meter
</span><span class='line'>
</span><span class='line'>import org.apache.commons.lang.StringUtils
</span><span class='line'>import org.jboss.netty.handler.timeout.TimeoutException
</span><span class='line'>import org.slf4j.Logger;
</span><span class='line'>import org.slf4j.LoggerFactory;
</span><span class='line'>
</span><span class='line'>import com.yunglinho.common.JsonSerializer
</span><span class='line'>
</span><span class='line'>import com.yunglinho.app.service.LocationService
</span><span class='line'>import com.yunglinho.app.core.model.Location
</span><span class='line'>import com.yunglinho.app.feature.SocialProfile
</span><span class='line'>
</span><span class='line'>import scala.concurrent.Await
</span><span class='line'>import scala.concurrent.ExecutionContext
</span><span class='line'>import scala.concurrent.Future
</span><span class='line'>import scala.concurrent.duration._</span></code></pre></td></tr></table></div></figure>


<p>過去我排 import 的慣用法是按 <strong>有授權疑慮</strong> 的順序去排</p>

<ul>
<li>com.* 的在最上面</li>
<li>org, net 排第二</li>
<li> 接著是排自己公司的東西，按 common, base, app 的順序去排，common 跟 based 是放 utilities &amp; framework ， app 就是放一個專案的東西了</li>
<li>最後scala &amp; java 的東西</li>
</ul>


<p>這樣排的好處是， code review 一眼看過去，就可以知道用了那些版權有疑慮的東西，而且 import 時，不會把 java &amp; scala 內建的東西蓋過去，同時也知道這支程式碼用了多少其它的東西</p>

<p>然而，這個機制，在 <strong>Scala&#8217;s Type Inference</strong> 的影響下，變的很不可靠。</p>

<p><strong>Type Inference</strong> 是初學 Scala 時，覺得很方便的一個功能，能夠在寫程式時，少打很多的字，例如：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>   // 在沒有 Type Inference 下， statement 的左右兩邊都要宣告型態
</span><span class='line'>   val location: Location = new Location("Taipei")
</span><span class='line'>
</span><span class='line'>   // 然而，左邊的這邊其實是也可以省下的
</span><span class='line'>   val location = new Location("Taipei")
</span><span class='line'>   
</span><span class='line'>   // 左右兩邊都沒有 *Location* 的存在，但是卻是被用在這邊了 
</span><span class='line'>   val location = locationService.lookup("Taipei")</span></code></pre></td></tr></table></div></figure>


<p>這看似方便的功能，卻有著非常深遠且負面的影響，在上面的例子中 <em>Location</em>  這類別，雖然在 import 時沒有出現過，但是卻是在 Reviewer 意料之外中，被帶入到了這程式碼中。</p>

<p>當然，在上面的例子中，<em>Location</em> &amp; <em>LocationService</em> 是一套的關念，所以沒有真的引入意料之外的 <em>Domain</em> 進來，但是如果今天程式碼寫的不好，是有個 <em>ApplicationContextHolder.getCalendarService</em> 的話，那就不一樣了。</p>

<p>在一行行 code review 時，有可能會抓到這問題，但是如果你沒有空一行行的看呢？或者是你是在 <em>refactor</em> 數千行程式碼時，那要怎樣一行行的去看呢？</p>

<p>所以，設計程式語言真的是很困難，一個看似方便的功能，卻在意料之外的地方造成困擾，讓我最近有點想回去改用 Java 。當然 Scala 還是個很好的語言，能夠幫我增加兩三倍的生產力，不過，卻會讓團隊工作時造成困擾。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/05/on-metrics/">談台灣年輕人低薪問題</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-06-05T01:35:00+08:00" pubdate data-updated="true">Jun 5<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>歡迎各位來到首屆的 Java Community Conference ，我是何永琳，目前於飛向科技擔任工頭，所謂的工頭，就是做
大家做的事跟做大家不喜歡做的事，什麼是大家不喜歡做的事呢？那就是管上線機器的大大小小問題。</p>

<p>在我們開始之前，先岔題一下，大家都是工程師，(放someone on the internet is wrong)應該都有些大大小小的睡
眠問題，過去我一直以為我一天有睡到七小時，一直到去年穿戴式配備的興起，我買了個 Jawbone 來戴（放 Jawbone Up的圖片)，
才知道我一天只睡六小時左右，中間的睡眠品質不佳。有了 Jawbone Up 天天計錄我的生活起居狀況，我才了解到自己真
正的狀況，才能著手改善問題。</p>

<h2>上面的故事，就是今天講題的主軸 測量 / metrics</h2>

<p>在軟體開發的過程中，程式的編寫，其實只在軟體生命週期的很小一塊，在經過數個禮拜至數週的開發及測試後，軟體就
被佈屬到線上環境中，在過去，可能是放在公司的機房中或是資料中心，現在則是被放到雲端平台之上，總之，你細心開
發的軟體，將要被真實世界開始摧殘。</p>

<p>在一個軟體的生命週期中，他可能會碰上大量的用戶擁入，也可能跑了數十天沒有重開，也有可能在臨晨三點碰上資料庫
備份，當然也有可能每兩個禮拜碰上其它整個的 REST API 不穩的狀況，在他跑了一兩年後，有可能被換到新的硬體上。</p>

<p>問題在於，你有沒有辦法知道這些狀況會不會出現，如果出現了，你能不能知道發生了什麼事；而且在這些狀況下，你的
應用程式會出什麼怪手？是全面性的慢下來、還是不可預期的某些 Thread 才慢些來，或者是，你的應用程式可以輕鬆
應付這些狀況，不用你擔心。</p>

<p>如果上線的系統不能應付這些狀況，你要做出什麼相對應的調整呢？？</p>

<h2>Metrics By Codahale</h2>

<p>Metrics 一套是由 Codahale 在 2011 公布出來的 Opensource 專案，自此之後，因為他的 API 設計精良又容
易跟其它的外部程式整合，所以開始被業界所採用。</p>

<p>http://codahale.com/codeconf-2011-04-09-metrics-metrics-everywhere.pdf</p>

<p>為什麼我們需要測量的原因</p>

<h2>手動調整</h2>

<p>Iterative tuning -> 建立假設 -> 重建問題 -> 提出對應 -> 修理 -> 驗證</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/05/on-compensation-of-youth/">談台灣年輕人低薪問題</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-06-05T01:35:00+08:00" pubdate data-updated="true">Jun 5<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>台灣這幾年商界、政界、很喜歡對年輕人指指點點，說只要努力就可以脫離 22K ，年輕人收入不好的問題根源是在年輕人上，所以在這邊寫一下我的看法。</p>

<p>我在美國念書畢業一年後，在 26 歲時，底薪收入就有八萬美金，後來我又幹了四年，回台灣又幹了四年，但我的收入連八年前的一半都沒有，所以說，是我能力退步了嗎？不對啊，我現在寫程式碼比以前快不知道多少倍，還帶一個團隊，怎麼可以說我退步了呢？</p>

<p>一個人所能領的薪水，是相對於他所能創造的產值，而一個人能創造的產值，則是基於他所在的團隊以及社會之上，我過去還是一兩年經驗的新人能領高薪，是因為我所處在的團隊、社會可以創造高價值，因此我所做的邊邊角角的工作，依附在團隊上仍是有價值的，公司就我當下及未來可能的貢獻，給我高的報酬。</p>

<p>所以說穿了，年輕人能領的薪水，很大的決定因素是在於這個社會能夠如何運用他們，這個社會的掌權者、這個社會的中監份子，能為年輕人創造怎樣的舞台，如果掌權者創造的社會有價值，能夠利用年輕人創造更多的價值，那麼年輕人自然能夠領高薪。</p>

<p>如過這個社會的掌權者，只在乎金錢遊戲，忽視產業，那麼年輕人沒有舞台，自然只能領低薪</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/13/tdd/">TDD</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-13T22:46:00+08:00" pubdate data-updated="true">May 13<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>總算是把 TDD 的戰文看完了，看完後我對 DHH 的評估仍是沒變。</p>

<p>DHH 在 Rework 中自述到，他偏好帶領一個三十人的團隊自在的工作，而不要把組織擴大到上百上千人把自己搞的焦頭濫額。 DHH 在組織架構跟應用範圍的偏好偏食，讓我在讀 DHH 文章時都會先考慮過他的出發點跟局限性。</p>

<p>以程式設計師的角色來說， DHH 的精兵政策當然看起來很爽，我自己也做過類似的選擇，捨棄 Java 而就 Scala ，追求更高的個人產值。</p>

<p>然而若是以一個架構師的角度來說，我的目標是成為像 Martin Fowler 的角色，相較於只有 36 個員工的 37 signals ，ThoughtWorks 是個有超過 2500 個員工的專業代工廠，在 ThoughtWorks 掛頭牌的 Martin Fowler 在技術的選用上，自然的考量要更全面，顧慮到不同應用領域的開發需求、以及不同程度的程式設計師該怎麼管理。</p>

<p>DHH 對 TDD 的批評我多數同意，尤其是 Testing / DI 對 Design 的入侵也是一直困擾我的問題，但是我是把 Testing 當成一個需求來看，所以是多一個需求造成的額外成本在困擾我，而不是降低可讀性等問題在困擾我。
在目前看不到較好的替代品之前，我還是會繼續用 TDD (w/o test first) 來做設計上的工法。</p>

<p>我目前對程式的想法是從資料做起，我做的系統，多數就是把輸入的資料，透過一串串的轉換，Map, Filter, Count, Sum, Aggregation 後，變成最後要的樣子，在A -> B -> C -> D 中間，可能會有一些中介型態的出現。</p>

<p>在我的設計中就會變成，在每一次的轉換的過程中，讓輸入輸出是可以被測試的，在設計階段就預先考量到要怎麼測試這些轉換。</p>

<p>至於會不會做 Unit Test, Test First, 我是看有多少時間做多少事的，但至少模組內的一串流程的測試是會去做的。</p>

<p>另外我會把 DAO &amp; Data Transformer(Service) 分開來，資料轉換的運算，是可以不用靠 DB 來的資料直接做測試，這樣跑起來才會快。</p>

<p>許多的商業邏輯，我會在 DAO -> Service 上再多架一層 Controller ，這個 Controller 就會很醜，因為只有三(四)層，所以一個 Controller 可能換串個十來個 Service ，但是醜的就是在這裡面而以。</p>

<p>測試的時候，至少是可以分層把底層容易測的都測好是穩定不容易出錯的，到時後上線有問題時，就可以知道是在 Controller 把東西串起來時出錯了。</p>

<p>沒有 Test First 沒有 Unit Test ，但是會做 regression test, integration test 會在設計時預先留下容易稽核的點。這是不是 TDD??</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/03/cross-strait-trade-agreement/">我看服貿</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-03T00:10:00+08:00" pubdate data-updated="true">Apr 3<span>rd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>幫大家用自由經濟的角度，來看看新光三越在中國被坑殺的例子好了～</p>

<p>我非常不喜歡大家用「台商在中國被坑殺」這個理由，來當做反服貿的理由，因為商人天性就是計算風險而不是閃避風險的，商人是在種種的計算下，在有相對應的報酬下，自然會去冒險，所以用「怕被坑殺」這理由去跟商人講為什麼要反服貿，這是自己講話給自己聽，而不是跟對方在對話。</p>

<p>世界不是繞著懦夫轉的，而是繞著喜愛風險的創業家在走的，若少了冒險的風氣，那台灣的未來就危險了。</p>

<p>想當商人的我，當然是（從一萬英尺高的概念上看下來）是支持自由貿易、支持西進的，但在「現實」上我仍是「反服貿的」。</p>

<p>為什麼呢？因為在細節的實作上，政府實在是談的太糟了，台商在中國會被坑殺是為什麼？是因為「中國法規的不穩定」及「中共政策的不穩定」所造成的，今天中國要吸引外資就開放產業，等那天反抗企業的母國，就用政府的力量在行政司法上去對抗民間企業。
但企業是否是真的無力去跟中共對抗嗎？錯，在國際上仍有商務仲裁的機制、有 WTO 的爭議處理機制，有國家間互相角力的機制，可以去保護企業。</p>

<p>但在「服貿」協議中，馬英九完全的出賣台灣，明知道中共會用台灣不是國家的方式否決掉上面的幾個機制，那麼，在談判時為什麼沒有把這問題拿出來討論？即使中共不承認台灣是個國家，但仍是可以在條約中寫入協商條款、保護台灣企業的權益。</p>

<p>而不是如今天寫的「服貿內的條款若要修改只能放寬」，這一條一寫下去，台灣政府跟中共談判的空間全沒有了，那天要打貿易戰也打不起來，因為台灣自己就把自己的條約修改空間、談判空間限死了。</p>

<p>這樣的「服貿」能說政府有用心去談而不是賣台嗎？能不反嗎？</p>

<p>ref: <a href="http://china.twdetect.org.tw/news15.html">北京新光投資130億　吳家擬認賠出場</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/26/role-model/">典範</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-26T21:31:00+08:00" pubdate data-updated="true">Mar 26<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>這篇寫的真好，在國外渡過我二十歲的歲月，三十歲回到台灣來，發覺，台灣人最缺的就是一個典範跟一個夢想。</p>

<p>台灣的年輕人活的很沒未來，常做一些很短期的事，像是一年換一次手機，一年就出國一次去玩，工作收入有個四五萬一個月好像就很滿足了。</p>

<p>這些，我不會去怪這些年輕人，因為台灣這個社會讓年輕人沒有了夢想，把手機的錢存下來又怎樣，什麼都還是買不起，買車買房都無望，還是今朝有酒今朝醉吧，比別人多努力兩成又怎樣，生活又不會過比較好，反而還比較慘。</p>

<p>我在美國單身的歲月裡，一年可以存下四成的薪水，工作了兩三年後，存下的錢在考慮要怎麼花，看是現金買部BMW M3圓夢、買個公寓省下房租、或投資做生意中做選擇，生活是一日比一日好。</p>

<p>回來台灣後發現，台灣年輕人最缺的，其實是生命上的導師、一個可以遵從的典範，一個長你十多歲，一個你一直努力，就可以達到他的境界的目標。</p>

<p>Ronald 是1.5代移民的香港人 30 歲幹到了 Director of Engineering ，Mak是日裔第一代移民 X-Window 中有他的名字，雖然英語不是他的母語，還是帶了 80 人，後來還跑去做了 Sims 3 ，Maidu 聯合國科學家的兒子，19歲大學畢業，30歲初頭時在兩年內在印度開了家公司，在舊金山生了小孩，還在 U of Chicago 拿 MBA，Stu 超級技術強人，幫我開了一輩子的眼界。</p>

<p>這些人是我工作的同事，長我五到十歲，讓我知道，只要有目標，忍耐得了寂默苦修，有一天我也可以達到他們的境界。</p>

<p>但是台灣的年輕人就沒什麼典範可以學習了，電視雜誌上報導的，多是六七十歲的大老，要不然就是官二代富二代；看這些人的故事，怎麼看都沒什麼好學的，反正再怎麼努力，你爺爺也不會變成姓蔣的，你無法去複製他們的成功經驗。</p>

<p>台灣因為市場結構問題，要打入既有商業體系的，都只能靠「關係」，我這幾年下來，碰上創業成功的，多是做吃的，因為只有做吃的不用靠關係可以直接面對市場。或許就是這樣吧，年輕人就只能學著當個好寶寶，等著接收長輩的蔽蔭。</p>

<p>所以看到陳為廷和林飛帆能幫年輕人立個典範，告訴大家，年輕人還是能改變社會，讓我非常的感動。</p>

<div id="fb-root"></div>


<p> <script>(function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "//connect.facebook.net/en_US/all.js#xfbml=1"; fjs.parentNode.insertBefore(js, fjs); }(document, 'script', 'facebook-jssdk'));</script></p>

<div class="fb-post" data-href="https://www.facebook.com/nai.lai.12/posts/10200710575647101" data-width="466"><div class="fb-xfbml-parse-ignore"><a href="https://www.facebook.com/nai.lai.12/posts/10200710575647101">Post</a> by <a href="https://www.facebook.com/nai.lai.12">蔡坤霖</a>.</div></div>


<blockquote><p>   蔡坤霖</p>

<p>   以下是我的立場。</p>

<p>   其實這樣寫很奇怪，為什麼會有人關心我的立場？不過既然臉書是私媒體，我不是公眾人物，也沒領稿費，那就當書寫為自瀆吧。</p>

<p>   我首先要懺悔：從2012以後，我就是個心存逃避的失敗主義者。馬英九上台，我認為，台灣人民已經做了選擇，那就是統一。</p>

<p>   既然要統一了，那我心態上可以提早做準備。我尊重台灣的民意，因此也沒想要多反映什麼，只想，啊，以後就當個共產黨治下的民眾吧。反正，我喜歡的東西是類型，如武俠、玄幻之類古代背景，沒有要談什麼高深的東西。</p>

<p>   但我內心其實相信，台灣不統一比較好。台灣之所以重要是因為它不是中國的一份子，如果它是中國的一份子，那台灣就不特別了。</p>

<p>   這句話很難簡單說明，但從對自己的經濟天賦失望之後，我就轉而將熱情投諸在不能量化的事物上。台灣保有獨立的主權，等於是為華人的政治實踐多了一所學校，畢竟華人作為地球上最龐大的民族，只有這個小小的島是民主的，只有這個小小的島，能夠提供集權之外的另一種可能。</p>

<p>   想像需要典範，對現在以及未來的華人而言，台灣就可以是那個典範，前提是台灣值得成為典範。</p>

<p>   既然台灣不願意成為這個特例，想要跟中國其他數十個省份一樣，那我接受台灣人民的選擇，所以我不再思考這件事情，只想著如果可以掌握好中國古代背景的類型電影，未來在華人市場應該都有飯吃。</p>

<p>   政治與文化的多樣性，台灣可以為華人保存這一小小的孤島。可不可以把台灣像是太平洋上物種歧異度高的一個小島一樣保存下來，進行一點政治體制上的一點研究呢？我在選舉前是這樣想的。</p>

<p>   這裡要先說兩點，我認為2012馬英九上台等於統一，和我認為統一之後台灣主體性會消失，並且成為文化上、思想上毫無特色的一個省份，這兩點是近乎宗教的信念，不在此論證由何而來。信者自信，疑者自疑，到處找找有很多說法、很多推測，但尚未發生，所以我沒有證據。</p>

<p>   在我心中，台灣如同雅典，雖小，卻體現著罕見而且影響深遠的故事。如同余英時所說：「台灣雖小，但其實它大極了。」</p>

<p>   等到未來某個世代的華人決定推翻共產黨時，他們知道他們可以看向哪裡。他們有機會知道，所謂華人不需要民主，是一個被兩千三百萬人證偽的謊言。</p>

<p>   然後台灣的民意放棄這件事情了，在2012年，689萬票這樣說。那就算了吧，何必思考呢？再說一次，這是我主觀如同宗教般的解讀，沒有任何依據。</p>

<p>   所以大埔，文林苑，我認為都更雖然執行粗糙，但有其必要性；核四，雖然粗糙，但確實能減碳，也高效率，很多議題我都覺得算了。幹麼想這些呢？有那麼多人不在乎政府違憲（是的，我先天上就覺得職業學生出身的馬英九從來沒在乎過憲法），反正遲早就要習慣沒有憲法的生活了不是嗎？</p>

<p>   到時候那些可以扭轉歷史的40萬人再來後悔吧，我從來沒投過馬英九，我可沒什麼好後悔，是被拖下水的。</p>

<p>   失敗主義、犬儒主義，自作聰明，未戰先退。我很懦弱。我不覺得我可以也必須抵抗689萬票，也不覺得有可能對抗13億。怎麼可能呢？世界上人口最多，最霸道，離我們最近的國家。</p>

<p>   吐口水就淹死我們了，拔根毛就脹死我們了。想想怎麼過得好吧，不要太激憤，不然，很可能到時候統一時，會死一票人。</p>

<p>   改朝換代，不都要血流成河？我們還看得少嗎？</p>

<p>   服貿只是歷史巨輪下的一個小齒輪。之前很多事情，台灣人不吭聲，是的，包括鄭秀玲教授的那些文字，一點屁聲都沒激起，台灣人沒有資格擁有民主，那就順勢而行吧。之後很多事情，也不會吭聲。</p>

<p>   到時候，就閉嘴，蘇軾不是說過了嗎？</p>

<p>   「夫持法太急者，其鋒不可犯；而其勢未可乘。」</p>

<p>   我是個聰明人，蒙田是我的偶像。蘇格拉底拿來意淫就好，不用仿效。</p>

<p>   但是我看到，陳為廷和林飛帆，居然能在馬王政爭時攻下立法院！</p>

<p>   我想都沒想過！居然還有這招？怎麼還有這樣的招數？從來沒有人攻打立法院呀！為什麼立法院居然可以被攻下來，而且還有人想到要去打下它？而且打下它之後，王金平居然真的不趕走他們？</p>

<p>   天哪，還有這一招！我嚇傻了。從沒想過鬥爭、反抗，以為選票就是一切的我被嚇傻了。我以為一切都已經注定好了，提早投降了。他們在實踐中獲得了我想像力之外的智慧與勇氣。我不覺得他們就比我聰明，書就讀得比我好，但他們年紀比我小，用這麼簡單、異想天開的方式，就告訴了全台灣，告訴了全世界。</p>

<p>   我不服，我有話要說，我想說的是，公民不服從。</p>

<p>   我知道公民不服從，我讀過梭羅，我知道甘地、曼德拉。但剛剛說過，想像需要典範，這兩個年輕人給我了典範，讓我敢想像。然後我發現，我還沒有年輕過，就已經老了。我在沒有天真前，就先世故了，我在還沒思考作戰前，我就先規劃好投降了。</p>

<p>   那之前，我以為人生最好是去美國，然後是去中國，離開台灣，離開被自己人放棄主權的悲情島嶼。我好懦弱。</p>

<p>   台灣，這個小小的島嶼，從以前就是強權間的遊戲，未來也一直都會是。當中國和平崛起，美國重新調整戰略思維，台灣民意悶不吭聲，我知道，事就這樣成了。</p>

<p>   我想像的台灣價值會被一個文革之後失去靈魂的國族吞吃乾淨，文革的火燒乾了中國的血性與道德，焦土之上只剩下消費主義的荊棘可以怒放，然後很快輪到台灣。</p>

<p>   但陳為廷和林飛帆讓我知道，事情還有可轉圜的餘地，大聲讓世界知道，我們不服從。畢竟，這句話這天不說，很快就不能說了。</p>

<p>   我一向很懦弱，所以我逃避思考，逃避現實，在故事的世界裡面永遠找得到避風港。我以為這樣我就不用害怕。</p>

<p>   但這時候我才知道我真正害怕什麼。</p>

<p>   我害怕，未來有一雙澄澈的眼睛，看著我，問我說當台灣被統一的時候，我做了什麼。</p>

<p>   我知道，我不能聳聳肩，冷笑說：「我怎麼知道，你老子我沒投過國民黨，那不關我的事。」</p>

<p>   那關我的事。</p>

<p>   高牆與雞蛋之間，雞蛋不可能贏。</p>

<p>   但人活著，要有骨氣。不可以什麼都還沒做，就先認輸。</p>

<p>   膝蓋還沒好，不能跑、不能久站、不能盤腿坐太久。那找兩天睡在外面吧，未來我可以告訴我的小孩，我那天晚上，看到的夜空很美，很年輕。</p>

<p>   最後，我還可以跟我孩子吹噓：「你老爸年輕時超會考試，考上了台大，那裡有個校長叫傅斯年；死過很多人，其中一個人是陳文成；那裡發生過哲學系事件。出過很多敗類，但也發生一些值得記住的事情。還是有些值得驕傲的地方。」</p>

<p>   我以身為台灣人為榮，我以身為台大人為榮。</p>

<p>   2014/03/25</p>

<p>   最後，請讓我打上這行超過四年沒有寫的頭銜：</p>

<p>   B93 台大經濟 蔡坤霖
   獻給B91鄧之皓</p></blockquote>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/22/wang-jin-pyng/">從立法院長王金平談遵守法定程序</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-22T23:02:00+08:00" pubdate data-updated="true">Mar 22<span>nd</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>紙牌屋</h1>

<p>王金平果然是老狐狸，什麼政爭，有他就好看了許多，似乎全中華民國政界講法律的就只有他一人而已。</p>

<p>先是學生佔領國會，行政單位用「國會自主」說國會殿堂歸立法院管，只有院長才可以動用警察權讓警察進入。</p>

<p>王金平就用非開議期間的佔領，是單純行政問題，請行政單位自行處理。</p>

<p>昨日總統要召開府院會議，調停行政跟立法的紛爭。</p>

<p>王金平說，審法條是立院自己的事，跟行政單位無關，沒什麼糾紛，拒絕出席。</p>

<p>今天行政院長跟學生會面，說考慮要逐條審察。</p>

<p>王金平又說，行政院提的解決方案跟立法程序不合。此外，怎麼審是立法單位的事，不容行政單位插嘴。行政單位有問題的，可以自己撤案，從頭再來一次。</p>

<p>這場戲，真的沒王金平不行啊，好好的幫台灣民眾上了一課什麼叫行政、立法、司法三權分立。</p>

<p>而且直把箭頭指准國民黨主席馬英九，因為只有國民黨主席可以要求立委撤回服貿的同意案。</p>

<h1>我想當好人</h1>

<p>王金平是不是(道德上)的好人我不知道，至少就很多中華文化的標準來看，他不是個好人。但是就法律上來說，他是個守法的好公民，也幫我們守住了法治社會的底限。</p>

<p>在學生佔領立法院的初期，有些人是期望王金平以立法院長的身份，去主張「國會自主權」並且同時不使用「警察權」去趨離學生的。</p>

<p>就此標準來看，王金平不保護學生，是道德上的壞人，但是，因為他什麼都就法律來主張自己的看法，反而讓學生運動有了更強的理論基礎、正當性。</p>

<p>學生運動本來是要求「行政單位跟立法單位要就法定程序來審服貿法案」。</p>

<p><del>但當學生要求跟總統對話時，總統派出了行政院長來對談，行政院長在自己職權外答應了一些事，我新聞沒看很清楚，印像是學生並沒有嚴詞拒決了行政院長的提案。</del></p>

<p><del>這時，學生已自己都踩了自己定下紅線而不自知，好險有王金平這老狐貍在旁，暗助了學生一把，說了行政院長所提的解決方案與法律不合，把大家的攻防，又拉回了「行政單位跟立法單位要就法定程序來審服貿法案」</del></p>

<blockquote><p>3/23 補注：剛看完了行政院長到現場的對談，原來行政院長當場什麼也沒答應，而學生也把底線抓的很好，
一直是都要求行政院就自己的職權來撤回法案。所以王金平只是補一刀而已</p></blockquote>

<h1>野蠻時代</h1>

<p>為什麼我們要看議事規範、要去就法律攻防，因為我們要避免回到今天的狀況，避免回到野蠻時代。</p>

<p>兩百年前，法國國會是議員有爭論，就是拔劍決鬥，但人家還是走過了那個階段，現在都是就議事規範來較競，不是再用武力對決，所以人家國會會有那種一講二十個小時，就為了阻擾法案通過。野蠻嗎？總比拔劍決鬥文明多了。</p>

<p>今天為什麼服貿的審議會讓那麼多人走上街頭，就是因為我們的國會往回走到了野蠻時期，主席可以跑到廁所門口，獨自宣佈表決通過，如果這樣子人民都還可以忍受，下次就是睡夢中就通過，或者行政單位直接執行，事後再補程序就好。</p>

<p>這種事情若還能接受，那就離獨裁不遠了</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/15/prepaid-card-lifetime-limit/">消基會抽查預付卡100%違規設使用期限，NCC：將要求業者改善</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-15T11:47:00+08:00" pubdate data-updated="true">Mar 15<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>這是鬧劇嗎？兩邊都是笑話。</p>

<p>電信公司給預付卡一個門號跟維持一個門號是有成本的，為什麼 NCC 可以要求業者要無限期的維持一個沒有使用中的門號，設使用期限或者是有每月低消本來就是很合理的事，中華民國政府的 &#8220;行政單位NCC&#8221; 竟然可笑的定了這種 &#8220;規定&#8221; 出來。</p>

<p>更可笑的是， NCC 自己定的 &#8220;規定&#8221; ，卻連自己都不去強制遵守，要求業者遵循規定。</p>

<p>「上下交相賊」，上個求個美名所以定個便民的規範，但是卻不去執行，把責任推給商家，真是好個「儒家社會」啊</p>

<blockquote><p>消基會抽查預付卡100%違規設使用期限，NCC：將要求業者改善
消基會抽查國內11件預付卡商品，發現100%都違反規定設有使用期限，應記載資訊也沒有完整詳細說明，NCC表示將進行查核，督促業者依規定落實改善。</p>

<p>文/蘇文彬 | 2014-03-14發表</p>

<p>消基會抽查11件電信預付卡商品，發現全部違反國內電信禮券定型化契約規定設定使用期限。</p>

<p>消基會調查電信業者推出的預付卡發現，預付卡雖然免綁約，且提供消費者控制通話費，但都訂有使用時間限制。對此NCC表示，電信儲值卡不應限制使用期限，將督促業者改善。</p>

<p>消基會這次一共抽查11件預付卡商品，其中7件為金額儲值型，4件為計量型上網儲值卡，並依據「電信商品或服務禮券定型化契約應記載及不得記載事項」不應限制用戶使用期限的規定，檢視抽查的預付卡服務內容說明是否有違反法律規定的情形。抽查的預付卡銷售商包括遠傳、台灣大哥大、中華電信、威寶、亞太、家樂福、7-Eleven等。</p>

<p>結果卻發現抽查的預付卡商品全部都設有使用期限，用戶每次儲值需在一定的時間內使用，業者通常限制為180天，上網儲值卡更只有30天，用戶在期限內再次儲值才能再展延180天或30天。</p>

<p>消基會指出，抽查的預付卡100%違反規定，並非消費者儲值後就能一直使用到儲值金額用完為止。一般購買禮券不因只消費部份金額，就被要求將剩餘金額在一定期限內消費完，但電信儲值卡卻有使用期限，除非再次儲值才能延後使用，但儲值金額用不完還要消費者再儲值才能繼續使用並不合理，且違反規定。</p>

<p>預付卡儲值金額若在時限內未使用完，部份電信業者可以申請退費，但部份業者規定只能辦理移轉，將預付卡內剩餘金額轉移到同一家業者月租費門號帳上，若用戶超過6個月沒有申辦轉移，剩餘儲值金額會保留，但會收取保管費直到扣完為止。</p>

<p>除了使用期限，消基會也發現其他資訊，例如業者名稱、地址、發售編號、履約保證、餘額處理方式、遣失處理等資訊在包裝或業者官網上說明不夠明確。</p>

<p>消基會表示，「電信商品或服務禮券定型化契約應記載及不得記載事項」在2007年通過，該年6月消基會首次抽查即100%違反規定設定用戶使用期限，今年再再次調查仍是100%違反規定，部份業者甚至規定屆期金額歸零，NCC應加強督導業者，消費者選擇儲值卡也應注意業者相關規定。</p>

<p>對於消基會抽查預付卡結果，NCC回應，依電信禮券定型化契約規定，逾期未使用完的傳輸量，用戶沒有特別聲明，應自動用以折抵通話費。消費者購買預付卡為不記名的禮券商品服務，依規定不得限制使用期限，NCC將會督促業者落實規定改善。</p></blockquote>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/19/on-load-testing/">從壓力測試回想到一些老故事</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-19T00:55:00+08:00" pubdate data-updated="true">Feb 19<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近壓力測試因為 <a href="http://www.cna.com.tw/news/aipl/201402180446-1.aspx">戶政系統</a> 的原因，上了幾天的新聞，講到壓力測試，就想到我這輩子職場上的一個恥辱，把一個產品搞倒的紀錄。</p>

<p>2007 年我還在 Rhapsody.com 時，當時我是擔任我們 webservice api 的 QA Lead ，做一個有 40 個內外部客戶的服務的守門員，每一次的產品更新，都要我跑完了數萬個測試，說可以出貨了才可以出貨。</p>

<p>四月時忙完跟 Tivo 的合作案，把系統的負荷量測到及調整到可以服務 500萬線上用戶的量後，另一個團隊又開發了新的 social 網站。</p>

<p>那是 facebook 才上線三年，或者說才對外公開服務的第一年，當所有人都還不知道什麼是社交功能時，rhapsody就已經開發出來社交功能，可以互相推薦音樂清單、可以 follow 別人、還可以自定 avatar</p>

<p>在上線前，我問了我的主管的主管，需不需要對 social web 的上線做測試，當時大主管是說不用。沒想到一上線，這 social web 非常的熱門，一下子就有數萬個用戶從標準的頁面轉換到 social 版去，似乎，一個新的 killer app 就要產生了。</p>

<p>然而才上線兩三天，網站的速度就慢了下來，後來才知道，原來 social web 濫用了我們的一個 GET api ，我們的 GET api 允許一次抓多個 object ，結果 social web 一次一個 request 就抓了 500 object ，一個 object 4k 就好，一次就抓 2MB ，在加上 object serialization 中間所花的記憶體空間，一個 request 就要佔 6MB 以上，一下就把那個年代的 server 打垮了。</p>

<p>就這樣，這個 social web 就下線整修，但不知為什麼，就此沒有再上線過了&#8230;.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/12/mongodb-mysql/">Mongodb vs MySQL/RDBMS</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-12T16:24:00+08:00" pubdate data-updated="true">Feb 12<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>許多人從 RDBMS 跳到 NoSQL 的第一站都是 MongoDB ，所以這一篇，就是特別寫來解釋，為什麼很多人選用 MongoDB ，以及解釋你為什麼不該用 MongoDB 來換掉 RDBMS 。</p>

<h2>MongoDB 熱門的理由</h2>

<p>MongoDB 熱門的原因是因為他提供了一個可以跟 SQL 相比的 <a href="http://docs.mongodb.org/manual/tutorial/query-documents/">Query Language</a> ，在 NoSQL 不同面向的眾多方案中， MongoDB 所能支援的 AdHoc Query 是沒人能比的， Riak 跟 CouchDB 的 AdHoc Query
也不差，但是 Riak 在跑 <a href="http://docs.basho.com/riak/latest/dev/using/mapreduce/">MapReduce Query</a> 時是不能透過 index 加速的， CouchDB 則是跟本不支援 index ，所以在這邊 MongoDB <strong>看似</strong> 是個很好的 MySQL drop-in replacement</p>

<p>使用 MongoDB 來取代 MySQL ，在初期，看來是學習成本最低，轉換風險最低的解決方案，所以多數商業公司，為了降低風險，在追循潮流一窩風的採用 NoSQL 時，選擇了 MongoDB 這個看似合理且安全的選項。</p>

<p>然而糖衣底下掩蓋的，卻是數不盡的陷井在那。</p>

<h2>Trade-Off</h2>

<p>技術的選用，往往是一連串的取捨，拿某樣功能去換回了另一項功能，所以，接下來我們就來看看，我們從 MySQL/RDBMS 跳到 MongoDB 去，我們到底是跟魔鬼做了什麼樣的交易，拿了什麼樣的東西，去換回了什麼。</p>

<p>首先，我們先看看我們換出去的是什麼？我們換出去的是 ACID (Atomicity, Consistency, Isolation, Durability) 及 Relational Model</p>

<h3>ACID</h3>

<p>對絕大多數的應用來說，交易的正確性跟不可否任性，是系統必要的基石， ACID 便是協助達成這一目標的工具之一。</p>

<p>ACID 雖然是一大重要工具，但也不是不能夠取代，像是 <a href="http://martinfowler.com/bliki/CQRS.html">CQRS Pattern</a> ， <a href="http://www.youtube.com/watch?v=BGxnjKd4MFQ">Cassandra Summit</a> 有一個很好的講題就是介紹怎麼用 Cassandra 透過 CQRS 來寫一個給銀行用的轉帳系統。</p>

<p><a href="http://msdn.microsoft.com/en-us/library/jj591569.aspx">SAGA Pattern</a> 則是另一個在沒有 Transaction 下，來解決多事件互動的 Pattern 。</p>

<p>然而 CQRS 或 SAGA Pattern 都沒有 Transaction 好用，以及廣被眾人所了解，連我自己都只是讀過沒有親身實作過，要做的話，連底層的工具都要自己從頭開始作，或者是要去學一些非常新的工具如 <a href="http://www.datomic.com/">Datomic</a> 。</p>

<p>因為換出的是 ACID 這樣強大的工具，替代的方案又是高未知的空間，所以許多人最後選擇的替代方案就是 &#8211; <strong>頭埋起來假裝沒有問題</strong></p>

<p>而且 MongoDB 本身號稱的 BASE 跟本是 Eventual Inconsistency ，在
<a href="http://aphyr.com/posts/284-call-me-maybe-mongodb">Call me maybe: MongoDB</a> 這篇文章中就驗證到，當 Network Partition 發生時，既使 MongoDB
回復寫入成功，但是實際上還是會失敗的，所以就在這種底層實作不可靠下，你上層加什麼工具也是枉然，所以多數人就是假裝沒這回事，想說自己沒這麼倒楣。</p>

<h3>Relational Model</h3>

<p>Relational Model 是三十年前那次 DB 戰爭中，打敗 Network Model, Hierarchical Model 剩出的王者，在三十年後，再次受到 Document Model 的挑戰，這次的結果如何呢？</p>

<p>Relational Model 的好處是可以透過正規化，減少資料的重複、提高資料的一致性，以及透過
SQL ，除了 AdHoc Query 外，還可以對多個 Table 進行 Joined Query，這個是 MongoDB / Document Model 所做不到的。</p>

<p>那這個特性重要嗎？我想透過一個例子就可以很簡單的介紹 Relational Model 的強大，跟 Document Model 在應用上會碰到的問題。</p>

<h4>Relational Model Example</h4>

<p>我們公司是做人肉搜索的，對於同一個人 / email 來說，我們會有很多來自不同來源的 metadata ，今天假設是兩個來源好了。</p>

<p>在 RDBMS 中，就是開兩個 Table ，各自記錄不同來源來的資料</p>

<pre><code>| TableA        | Email         | likes      |
| ------------- |---------------| -----------|
|               | billg@ms.com  |  1600      |


| TableB        | Email         | tweets     |
| ------------- |---------------| -----------|
|               | billg@ms.com  |  9999      |
</code></pre>

<p>在 Document Model 可能就是用一個 Document 如</p>

<pre><code>{
    email: "billg@ms.com",
    likes: 1600,
    tweets: 9999
}
</code></pre>

<p>在 Query 時，前者要一個 join 才可以取回關於這個 email 的所有資料，後者則是一個 lookup ，自然後者的效率較好，而且同樣可以對不同的欄位下 Query 條件。</p>

<p>然而，既然要用 NoSQL 就要玩 <strong>BIG DATA</strong> ，所以我們把問題修改一下，我們從兩個來源，分別拿到十億筆
email 的 likes 數，跟十億筆 email 的 tweets 數，我們想把這些資料寫到 DB 去再拿回來用。</p>

<p>用 RDBMS 自然是輕鬆愉快，兩個檔案輪流打開，一筆筆的加到 DB 中，DBMS對這種簡單的寫入可以做到 10,000 insert / sec 沒問題，大概 55 分鐘就可以做完了。</p>

<p>但是 MongoDB 呢？因為兩個屬性都是在同一個 Document 上，所以要馬是先把十億筆 (email, likes) ，先寫到 MongoDB 中，再下十億筆 Read + Update 把 Document
讀回來再加上 tweets ，如果很不幸你的 Document Id 不是 email ，那就是要下十億筆 Search + Update ，不管怎麼算，都不是太漂亮。</p>

<p>另一個作法是，你先把兩個十億筆的資料在本機的記億體中做 join ，然後再寫到 MongoDB 去，ㄜ&#8230; 這樣搞你不覺得累嗎？這麼小的應用問題就要自己動手刻程式碼，而且
前面我們不是說 big data 嗎？如果資料不是十億筆而是一百億筆，你放不進記億體中，那你要先用 radix sort 寫到 file system 再讀回來嗎？</p>

<p>然後你忙了這麼多後， MongoDB 給你的，因為 global write lock ，還是一樣是 10,000 insert /sec ，然後因為 MongoDB 實作的問題，如果你的 Document 有 indexed field
，那麼寫到兩百萬筆後會越寫越慢，這問題在成熟的 DB 上是沒有的。</p>

<p>我想，這個小例子就說明了 Relational Model 的強大之處及 Document Model 弱的地方，當你要既有的資料新增欄位時， Relational Model 是可以很簡單的增加一個
 column 或 table 就做到，在 MongoDB 上，則是要跳過重重關卡才可以達成。</p>

<p>在軟體需求不穩定時，或常有變更時 Relational Model 對變革的適應能力，較 Document Model 高出許多。</p>

<h2>MongoDB 的長處</h2>

<p>在交換出 <code>ACID</code> 與 <code>對Model 對變革的適應能力</code> 後，我們從 MongoDB 到底換回來了什麼呢？</p>

<ul>
<li>cluster 帶來的更多的儲存空間</li>
<li>cluster 帶來的更 scalable read operation.</li>
<li>在某個資料大小下，一個非常快速的 index</li>
</ul>


<p>前兩個長處就不用多談了，Opensource RDBMS的長處並不在這塊，跟從一開始就要做 cluster 的 MongoDB 是沒得比的，MongoDB 目前已有超過 100 node 的單一 cluster。</p>

<p>第三個先略過不說，等說完結論再回來說</p>

<h2>結論</h2>

<p>我們看完了 Trade-off 後，我們要來思考一下，我們這個交易到底划不划算？</p>

<p>對我來說，我們換出了 ACID 跟 <code>對Model 對變革的適應能力</code> 後，我們換回來的僅僅只有 Scalable storage &amp; scalable read ，
就我看來，這是一筆極差的交易，因為這個換回來的東西大多只能應用在一塊很小的地方，一個需要大量儲空間、一個需要大量讀取能力的應用，而且後者還可以被 cache 所取代。</p>

<p>前面講的 <code>在某個資料大小下，一個非常快速的 index</code> 就是指這個應用範圍， <a href="https://twitter.com/dickwall">Navigenics 的 Dick Wall</a> 就講過，他曾用 MongoDB 用來儲存要配對的 DNA Sequence
，他的資料大小，剛好是大到無法用 Redis 放在記億體中，但是 index 的大小剛好是可以透過 MongoDB 全部放在記億體中，剩餘的資料則是存在硬碟上，就這麼剛好透過
MongoDB ，在下複雜 Query 時，他的搜尋速度可以達到 MySQL 方案的一百倍。</p>

<p>然而，真正 big data 的應用，如 log storage &amp; analysis ，MongoDB 是無法達到對 write operation 的需求的。 MongoDB 能適用的問題空間實在太小，而且既使你目前的需求是在 MongoDB
能達到的範圍內，但需求一變化，就長到 MongoDB 無法承擔的空間去了。</p>

<p>這也是我未來不會採用 MongoDB 的原因，在小量資料時，我會用 PostgreSQL / MySQL ，在資料量大時，會用 Postgres + Cassandra + ElasticSearch</p>

<h2>附注</h2>

<p>既然我說 MongoDB 的這筆交易不是個好交易，那什麼是好交易呢？</p>

<p>我覺得 Cassandra 這個就是個好交易，我們拿 ACID, AdHoc Query 出去換。是的我們把 AdHoc Query 都拿出去換掉了，換回來的是一次只能問兩個問題的 Query ，而且這兩個問題還是在 Table Design 時就要決定的。</p>

<p>但我們換回來的是幾乎無上限的 Read &amp; Write operation 能力 ，在<a href="http://techblog.netflix.com/2011/11/benchmarking-cassandra-scalability-on.html">Netflix 的測試中</a>，Cassandra 單一節點可以有 10,000 rw/sec ，然後一路隨著增加到 288 個節點，每加一個點可以增加 10,000 rw/sec 。</p>

<p>這個才是我說的好交易，因為這個特殊能力，是其它解決方案都辦不到的；雖然說我們交易掉了 ACID &amp; AdHoc Query ，但是透過適當的 Table Design ， Cassandra 的特性剛好可以用來解決 Big Data 中 log storage &amp; analysis
這個大部份人需要解決的問題。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/04/23/type-inference-and-code-review/">Type Inference 在實務上碰上的問題</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/05/on-metrics/">談台灣年輕人低薪問題</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/05/on-compensation-of-youth/">談台灣年輕人低薪問題</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/13/tdd/">TDD</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/03/cross-strait-trade-agreement/">我看服貿</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Facebook</h1>
  <div class="fb-follow" data-href="https://www.facebook.com/yunglin.ho" data-width="260" data-show-faces="true"></div>
</section>
<section>
  <h1>Twitter</h1>
  <a class="twitter-timeline" href="https://twitter.com/yunglinho" data-widget-id="379628400123445248">Tweets by @yunglinho</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</section>


<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/101164690243066571931?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



<section>
<a title="tumblr stats"
href="http://statcounter.com/tumblr/" target="_blank"><img
src="http://c.statcounter.com/8085210/0/5c96ca74/0/"
alt="tumblr stats" style="border:none;"></a></section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 -  -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'yunglin';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
