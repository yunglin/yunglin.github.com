<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>碎碎念</title>
  <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://yourdomain.com/">
  <link rel="alternate" type="application/rss+xml" title="碎碎念" href="http://yourdomain.com/feed.xml">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-11857878-6']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">碎碎念</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/archives/">Archives</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="home">

  <!-- This loops through the paginated posts -->
  
  <h1><a href="/blog/2016/02/03/a-normal-day-in-san-francisco-ii/">舊金山正常的一日  細數過去三個月的瘋狂案例</a></h1>
  <p class="author">
    <span class="post-meta">Feb 3, 2016</span>
  </p>
  <div class="content">
    <p>搬來舊金山三個月，暴力事件實在太多，就來列一下發生在我每日會經過的地點發生的暴力事件吧。</p>

<p>十月中，我剛搬到美國時，公司安排的宿舍，是在市中心 SOMA 的高級公寓。在美國，市區就是治安最不好的區域。在我住的一個月間，一樓死過兩個人。</p>

<p><img src="/images/oct_15.jpg" alt="Oct 15">
<a href="http://www.sfgate.com/crime/article/Shooting-shuts-down-San-Francisco-s-Market-6572784.php">Officer-involved fatal shooting shuts down S.F.’s Market Street</a></p>

<p>第一件發生在我到的當天下午，在我還在機場時，一樓有個二十多的流浪漢，對過往的汽車丟執酒瓶，當兩個警察過來的逮補他時，在拉扯間流浪漢去搶警察腰間的槍，所以就被另一位警官開槍打死了。</p>

<p><img src="/images/nov_death.jpg" alt="Nov">
<a href="http://kron4.com/2015/12/16/video-san-francisco-police-investigating-beating-death-of-elderly-artist/">San Francisco police investigating beating death of elderly artist</a></p>

<p>另一件則是在十一月時，一位七十四歲的老先生，晚上七八點在公車站等公車，一個黑人走經過，沒理由的就賞老先生一拳，老先生倒下時頭撞到路面，沒幾天就過去了，殺人的黑先生當然沒被找到。</p>

<p><img src="/images/gunman-hospital.jpg" alt="Gunman">
<a href="http://www.nbcbayarea.com/news/local/Police-Respond-to-Shooter-on-Roof-of-St-Lukes-Hospital-in-San-Francisco-346283602.html">Police Shoot, Kill Gunman Who Pointed Rifle at San Francisco Hospital</a></p>

<p>下一件案子就更經典了，你會以為是在玩 GTA ，一個年輕人到市區南邊的運動用品店，持刀搶了一支萊福槍。接著到不遠的工地裡，爬到正在蓋的大樓上方，描準了對街醫院的大門開槍，讓整個地區被封閉了數個小時，直到槍手被擊斃。</p>

<p><img src="/images/San_Bernardino_shooting_suspect_vehicle.jpg" alt="San_Bernardino_shooting_suspect_vehicle.jpg">
<a href="https://en.wikipedia.org/wiki/2015_San_Bernardino_attack">2015<em>San</em>Bernardino_attack</a></p>

<p>中間插播一個南加的新聞，一對中東裔的夫妻，開著防彈裝甲車，帶著自動步槍、手槍跟手榴彈到先生工作的地方，造成十六人死亡後，開始逃亡然後被擊斃。</p>

<p><img src="/images/mission-garage-closed.jpg" alt="Mission garage closed">
<a href="http://www.sfgate.com/crime/article/S-F-s-5th-and-Mission-garage-closed-after-6658242.php">S.F.’s 5th and Mission garage reopened after shooting, search</a></p>

<p>到了聖誕節前夕，舊金山市區也不平靜，在市區最熱鬧的百貨公司的車庫內，於下午六點半時，有個人正在準備付停車費時，被人往身上開了幾槍，不過沒掛。</p>

<p><img src="/images/bart_oakland_shooting.jpg" alt="Bart Shooting">
<a href="http://abc7news.com/news/witnesses-speak-out-about-west-oakland-bart-shooting/1153428/">Deadly West Oakland BART shooting</a></p>

<p>接下來的案子，發生在舊金山到奧克蘭的捷運上，當捷運到站，有個黑人下車時，朝了坐在旁邊的拉丁人的頭上就開了一槍，當眾人幫中槍的人急救時，發現中槍的人手上有隻刀。幾天後的調查結果是，被槍殺的是未成年的青少年，事前兩人在另一輛公車上就有口角。</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/7OIpJfPPMWQ" frameborder="0" allowfullscreen></iframe>

<p>最近這兩周，舊金山在辦超級杯的慶助活動，市場大街上有上百個警察，然後本地的摩托車幫派就在市場大街上挑倖，翹孤輪、衝過行進中的車輛、逆向在車陣中鑽，然後上百的警力就是在路旁什麼都辦不到。</p>

<p><img src="/images/chp_stabbed.jpg" alt="CHP stabbed"></p>

<p>昨天，在同事住的高級公寓前，一個亞裔流浪漢想吃免錢的牢飯，就拿刀戳了警察。</p>

<p><img src="/images/Pier_14_SF.JPG" alt="Pier 14 Shooting">
<a href="https://en.wikipedia.org/wiki/Shooting_of_Kathryn_Steinle">Shooting<em>of</em>Kathryn_Steinle</a></p>

<p>最後，倒帶回去年七月，一個眾多意外集合而成的悲劇。</p>

<p>一位聯邦幹員到舊金山出差，把槍放在車上被偷了，三天後，槍隻在市區的觀光碼頭被流浪漢撿到，流浪漢突發奇想，要開槍射海上的海豹海獅，沒想到手滑，流彈就打到了在長堤上跟父親正在散步的正妹，正妹留下一句「爸爸救我」就這樣過去了。</p>

<p>這幾個案子最可怕的事，全部都是隨機暴力事件，發生在平日的時段，你想躲或避都避不開。我住在西雅圖三年，一樓有開過兩次槍，可全是凌晨我睡死的時候，不是在大白天啊。</p>

  </div>

  <h1><a href="/blog/2016/02/03/a-normal-day-in-san-francisco/">舊金山正常的一日</a></h1>
  <p class="author">
    <span class="post-meta">Feb 3, 2016</span>
  </p>
  <div class="content">
    <p>雖然曾經在美國住過七年，但是搬來舊金山三個月，實在是無法忍受舊金山的治安問題。</p>

<p>剛剛在搭輕軌電車回家的路上，就在到家的前一站，差點人生就要在眼前走了一遭。舊金山輕軌的車箱長這樣</p>

<p><img src="/images/muni_metro.jpg" alt="Muni Metro" title="credit: https://www.flickr.com/photos/hercwad/2291171962"></p>

<p>我站在右邊第二三個坐位前面，有個拉丁辣媽，一百五十幾公分，帶著兩個小孩一個五歲一個十歲左右，兩個小孩坐著，媽媽抓著旁邊的欄杆。</p>

<p>車子本來已經要離站了，不知道是因為紅燈，還是因為我拉了下車鈴，本來已經關門等著要走的車子又把車門打開。</p>

<p>然後一個黑人大漢，大約四十多，從我背後走了過去，站在左邊的欄杆旁，開始跟另一人吼叫，吼什麼我沒注意，反正舊金山瘋子很多，隨時有人在車上亂吼。</p>

<p>沒想到這個黑人大漢，吼了一吼後，就推了拉丁辣媽一把，拉丁辣媽也很強悍，不管大漢比她高出二十多公分，跟他念「關我什麼事」。大漢說你問跟我對吼的啊，然後又抓著辣媽的背往柱子撞上去。</p>

<p>我開始往旁邊移了一步，辣媽則進入戰鬥模式，賞了大漢一個正拳，然後兩個人就開打了啊，才不到一秒辣媽就不敵了。</p>

<p>這時觀看四週，公車雖然滿的，但是周遭除了我外，都是老弱婦孺，正在我在掙扎該怎麼做時，剛剛對吼的另一人站了出來，站到我旁邊，然後我又默默的退了一步。</p>

<p>這時我才看到，原來另一人是個西裝筆挺，像是電影中黑人牧師的中年大漢，手上還拿著未伸出的伸縮警棍，站出來嚇止了大漢。</p>

<p><img src="/images/baton.jpg" alt="伸縮警棍" title="https://en.wikipedia.org/wiki/Baton_%28law_enforcement%29"></p>

<p>打人的大漢就跟牧師對峙了五秒吧，就下車了，然後坐著的乘客喊大漢手上有刀！</p>

<p>打人的大漢下車了也不走，就站在車外不走；公車司機當然也不開車了，跑來問要不要報警，旁人當然是說要，辣媽一邊哭一邊念「我做了什麼？」，想不開又想下車理論，旁人當然又喊：「他手上有刀！」</p>

<p><img src="/images/muni_metro_station.jpg" alt="Muni Station" title="credit: http://www.stadium-advisor.com/san-francisco-giants-stadium.html"></p>

<p>然後，眾人就被困在車上，隔著關著的門窗看著大漢在窗外不走，直到警察五分鐘後趕到，大漢自行成大字型趴在地上等著搜身。</p>

<p>整個過程真的是嚇到了我，如果黑人牧師沒有跳出來，再幾秒，不就換我要上了嗎？可是我真的不想去跟個一百八十幾的大漢拉扯啊。而且瘋漢身上還有刀，差點就要上演殺破狼了啊。</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/Yv9GGcc7adE" frameborder="0" allowfullscreen></iframe>

<p>當然，最厲害的還是辣媽帶的兩個小孩，事發到警察來再到下車報案，十幾分鐘，兩個小孩都沒有哭，坐在原地當什麼事都沒發生的發呆。</p>

<p>驚魂未定的我，回到家，馬上把買了很久都沒拆封的防狼噴霧放到了外套慣用手的口袋當中。</p>

<p>住在西雅圖市區三年，天天走路上班，三年下來從沒碰上過暴力事件，但是住舊金山三個月就碰到許多狀況跟看到許多匪夷所思。看來今年房租到期，應該會搬到郊區去住，開車上班，雖然交通狀況不理想，早上上班要開一個多小時才會到，但是至少不會碰上暴力事件。</p>

  </div>

  <h1><a href="/blog/2016/01/23/raising-a-bilingual-child/">如何教出一個雙語的小孩</a></h1>
  <p class="author">
    <span class="post-meta">Jan 23, 2016</span>
  </p>
  <div class="content">
    <p>推薦一本書 <a href="http://www.amazon.com/gp/product/1400023343/ref=as_li_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1400023343&amp;linkCode=as2&amp;tag=murmur-20&amp;linkId=3XFYGVGWNMJ4TEBD">Raising a Bilingual Child</a> ，相對於訪間口耳相傳的八卦，本書是由學者寫成，引用美國數個研究單位的研究成果，來告訴大家如何教養出雙語的兒童。</p>

<p>書中主要引用的研究資料是來自佛羅里達，因為佛州有眾多的西語系移民，家庭的社經環境各種都有，所以在統計上去掉一些其它因素的造成的誤差。</p>

<p>我讀到目前讀到比較有用的有幾點：</p>

<p>五歲以下的移民，在上 K5 前，若是只用母語，並不會影響未來的英語學習，反過來，若是在上 K5 前就開始學習雙語，只有 20% 的小孩未來還能學好母語，某一天就會轉成用英語為主。</p>

<p>母語的學習，並不會影響到英語的學習成果，既使是五歲才開始學習英文，到十一歲後，就在統計上看不出來英語學習的差易。</p>

<p>如果要學習好母語，除了日常對話外，還是要增加字彙的種類，雙語學校(immersion school)的教學就很有幫助。</p>

<p>以高中及大學 GPA 來看，雙語的學生表現跟英語的學生一樣好。但是很不幸的是， SAT 的測驗中，雙語的學生會比英語的學生低 50 分，這是未來 SAT 要努力的方向，為什麼測驗沒有鑑別能力。</p>

<p><a rel="nofollow" href="http://www.amazon.com/gp/product/1400023343/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1400023343&linkCode=as2&tag=murmur-20&linkId=ORPRZ3P5GPDA5JXA"><img border="0" src="http://ws-na.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=1400023343&Format=_SL250_&ID=AsinImage&MarketPlace=US&ServiceVersion=20070822&WS=1&tag=murmur-20" ></a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=murmur-20&l=as2&o=1&a=1400023343" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></p>

  </div>

  <h1><a href="/blog/2016/01/16/affirmative-action/">矽谷科技業的面試規則</a></h1>
  <p class="author">
    <span class="post-meta">Jan 16, 2016</span>
  </p>
  <div class="content">
    <p><a href="http://cn.nytimes.com/education/20160117/c17harvard/zh-hant/">紐時：當哈佛大學免費了，亞裔就不會被歧視？</a></p>

<p>十多年前剛到美國時就被教授的言論嚇到過，當時他是勸說一位亞裔同學不要對分數的得失心太重。</p>

<p>當時教授是說，他在柏克來大學擔任率取委員會，如果真的照學業成績來錄取學生的話，那全校會有五成是亞裔。</p>

<p>我不覺得老先生是有任何種族歧視的念頭在裡面，只是時至今日，美國的平權法案真的是對亞裔很不利，因為照數字算，加州目前有三成多的居民是亞裔，<a href="http://diversity.berkeley.edu/undergraduate-students-current-census">伯克來錄取的學生若是有四成是亞裔</a>那很正常阿。</p>

<p>為了平權法案，弄了一堆的藉口來卡住亞裔學生，反而是反向的歧視，只照顧到了非裔的族群。</p>

<p>話說，這週公司有了新面試的要求，規定的更嚴格，要求評分的標準，只能照當出發出去的職位敘述來評分，不能有額外的加減分項目。</p>

<p>目前矽谷科技大頭面試的方法都是，有一群員工負責面試，每一個面試官，都要用客觀的敘述來描述面試的過程，然後再由另一群任用委員會，依照面試官給的評語，來決定這個人的特質如何，該不該錄取。</p>

<p>說穿了，用這麼複雜而沒效率的方式，就是怕被政府稽核跟怕被告歧視。所以要用這種方式，讓任用委員會無法直接接觸到被面試的人而產生在工作項目以外的偏好。管你長的正不正、有特殊的個人媚力、還是有特殊的疾病，任用委員會都看不到，不會因為這些項目而偏好或歧視你。而這麼多的紙本文件，就是怕被告時，能夠直接拿出來證明沒有歧視。</p>

<p>至於說招人一定要按照職位敘述來評分，我猜想是因為 H1B 外籍白領招募時，要先證明找不到本地人才可以招外國人，所以才要這麼重視招進來的人跟職位敘述合不合。</p>

<p>目前矽谷各科技業大頭都很怕被告，像是某公司，最後一個非裔高層離職了，公司甩不開種族歧視的惡名，還特別創造一個高層的職位出來請了個非裔的進來。</p>

  </div>

  <h1><a href="/blog/2015/12/21/worse-is-better-mysql/">MySQL 劣即是夯</a></h1>
  <p class="author">
    <span class="post-meta">Dec 21, 2015</span>
  </p>
  <div class="content">
    <p>MySQL transactional lock 在 throughout 上 遠遠不及實作 mvcc 的 PostgrSQL，但在使用上，卻是大大的勝過 pg</p>

<p>原因是因為，在 pg 在寫程式裡，要處理很多因為碰撞產生的 rollback ，即使 db 會幫你處理，但是如果有外部系統呢？是要去招回還是要用 2 phase commit 呢？還有在 UI 上是要讓使用者馬上再試一次，還是請他五分鐘後再試一次了？</p>

<p>所以最簡單的實作就是乾脆把整個 table 鎖住，一次一個人寫入，這樣就不用做例外處理了。</p>

<p>科科科 <a href="https://gist.github.com/audreyt/3985324#%E5%8A%A3%E5%8D%B3%E6%98%AF%E5%A4%AF">劣即是夯</a> 啊</p>

  </div>

  <h1><a href="/blog/2015/12/12/financial-service/">重回美國心得 - 金融業</a></h1>
  <p class="author">
    <span class="post-meta">Dec 12, 2015</span>
  </p>
  <div class="content">
    <p>離開美國五年再回來，金融業變化還真大啊。</p>

<p>GE Capital 的零售銀行被分割出來，變成 Synchrony Bank ， GE 要把主力放在投資銀行的事業上。</p>

<p>Intuit 要把 30 年前開發，到目前都還是業界獨佔的 Quicken 賣掉，不再繼續開發，要把主力放在中小企業用的 Quickbook 跟 SaaS 的 Mint.com 上面。</p>

<p>FinTech 開了許多家，Personal Capital, Betterment WealthFront, Acorns ，雖然說整體的產品仍是比不上直接買 Vanguard Target Retirement Fund 的投資報酬率高，但是方便及充滿資訊的 UI ，讓許多年輕一代逃過收取 2% 手續費的傳統理專的魔掌。</p>

<p>兩年前就有聽過這些東西，不過直到回到美國，把自己的帳戶再調整一下，才發現變化還真大。</p>

  </div>

  <h1><a href="/blog/2015/11/26/energy-meter/">智慧電表</a></h1>
  <p class="author">
    <span class="post-meta">Nov 26, 2015</span>
  </p>
  <div class="content">
    <p>美國的電力公司真誇張，五年內進化到了讓使用者知道每小時的用電量，然後已經可以按照不同時段來收電費。</p>

<p><img src="/images/pge.png" alt="pg&amp;e"></p>

<p>反觀台灣，台電領了經濟部一堆補助，說是要在 2015 年完成安裝智慧電表到百萬戶，結果只有安裝一萬戶，然後就用成本不符不繼續執行計劃，反正國營企業，全民買單就好</p>

<p>http://news.ltn.com.tw/news/focus/paper/880231</p>

  </div>

  <h1><a href="/blog/2015/09/24/struggling-in-taiwan/">關帳戶</a></h1>
  <p class="author">
    <span class="post-meta">Sep 24, 2015</span>
  </p>
  <div class="content">
    <p>啊，我的修養還是不夠，沒想到在台灣關個銀行戶頭，都要叫經理出來，還不能解決 Orz....</p>

<p>我有一間自己的公司，因為要長期出國，要把公司跟公司戶關掉，打去銀行問要帶什麼文件。</p>

<p>結果今天去，才跟我說缺公司登記文件。</p>

<p>回家，下午再來，又跟我說，要關甲存要連未用完的支票都帶來。</p>

<p>然後我就爆氣了，要行員幫我寫一樣樣下，到底關帳號要那些文件才可以關....</p>

<p>然後又被台灣的金融制度上了一堂課，原來關甲存帳戶，過去未用完的支票全部都要帶來，要不然一張要罰 240元跟簽切結書。</p>

<hr>

<p>話說我三年前，人在台灣，還透過 email &amp; skype out 開了 Wells Fargo 的戶頭，後來要關時，也是兩封 email 就關掉了，不用負責人親自到、不用把 debit card 寄回去、不用把支票簿寄回去</p>

<hr>

<p>我可以理解，為什麼中華民國會要求支票要還回去，因為過去台灣芭樂票盛行，而中華民國又是個 nanny state ，什麼事都要政府負責，所以連個支付工具都要上層層的鎖。</p>

<p>在美國，個人支票就是沒什麼保障，要保障，請去買銀行本票 cashier check 。我當年要賣車時，就是跟買主約在銀行裡面，請他當場買 cashier check 給我，我再存進戶頭，而他把車子跟車籍資料帶走，當下就結清交易。</p>

<p>至於為什麼要用 cashier check 還有一個原因，因為在美國支票存進戶頭，帳戶上暫時會顯示這一筆進帳，但是還是要三到五天才能結清，所以既使存進去還是可能會跳票。</p>

<p>而當下結清，是商業運作上很重要的，因為當下就可以把風險減到零。反而在台灣，沒有這種安全、有紀錄、一手交錢一手交貨的運作的機制。</p>

<p>在台灣買車、買結婚戒指，還是要先到銀行轉帳給賣主的個人戶頭，才能領貨。非常沒保障。</p>

<hr>

<p>最後，講到影響最大的，其實是台灣商業跟生活的雙軌制太嚴重。</p>

<p>我在美國只有生活七年，個人的金融交易方式，就是公司的金融交易方式，並沒有什麼太大的差易，都可以用經驗、常理判斷。</p>

<p>而在台灣，我是一個商學院畢業的學生，我自認對台灣社會運行的方式在同儕間算是不錯的了，念過會計，幫忙 &quot;手工&quot; 過帳過，上週才把我的公司法、商事法課本給丟掉，但是在過去幾年間，被台灣的會計及金融制度還是撞上許多的問題。</p>

<p>無法把生活經驗推演到商業上的運作，我想是台灣在培養商業人材上，很大的問題。</p>

  </div>

  <h1><a href="/blog/2015/06/01/parking-token-exception-handling/">遺失停車代幣的解決方案</a></h1>
  <p class="author">
    <span class="post-meta">Jun 1, 2015</span>
  </p>
  <div class="content">
    <p>停車把代幣給搞丟，結果意外的上了兩課。</p>

<p>原來停車場收費機，往四個角點兩下，可以叫出隱藏的控制面板，輸入密碼後，繳當日最高停車費及罰金後，會掉一個不一樣顏色的代幣出來，可以讓你直接出場。</p>

<p>第二課是，我拿到的代幣壞了(運氣真好)，停車場管理員，雖然下班了，還是可以透過手機，直接看監視器跟操作停車桿，直接放我出場。</p>

<p>這次我運氣不錯，兩年前，代幣被嘟嘟房的機器吃掉，繳完錢不退我代幣，打過去是 0800 中心接的，一點忙都幫不上，還好機器過了五分鐘後，良心發現，退給我。</p>

<p>不知道這系統是誰做的，把例外處理做的這麼好，前前後後才擔誤我十分鐘，我還以為要等收費員從家裡趕來，還是說隔天早上才能取車。</p>

  </div>

  <h1><a href="/blog/2015/04/23/type-inference-and-code-review/">Type Inference 在實務上碰上的問題</a></h1>
  <p class="author">
    <span class="post-meta">Apr 23, 2015</span>
  </p>
  <div class="content">
    <p>最近在讀 <strong>Implementing Domain-Driven Design</strong> 這本書，學習一下別人
是怎麼整理好整個大型軟的架構，並且重新檢視一下我們公司的程式碼的問題。</p>

<p>在 DDD 的概念中，一個模組 <strong>Domain</strong> / <strong>Bounded Context</strong>  應該是一個獨立的觀念，一個大型程式，應該是由許多 <strong>Bounded Context</strong> 組合而成，整個程式的架構應該僅量保持這些的純淨性，<strong>Bounded Context</strong> 的互用，要把上下行的關係定義清楚，程式碼間不應該在一個區塊中引入多個 <strong>Bounded Context</strong>。</p>

<p>在整實作上，如何合檢視一個 class 是否有妥善的處理引用入的 <strong>Domain</strong> ，最簡單也最好用的方式就是看檔頭 <strong>import</strong> 的地方</p>
<div class="highlight"><pre><code class="language-" data-lang="">import com.codahale.metrics.Meter

import org.apache.commons.lang.StringUtils
import org.jboss.netty.handler.timeout.TimeoutException
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import com.yunglinho.common.JsonSerializer

import com.yunglinho.app.core.model.Location
import com.yunglinho.app.feature.SocialProfile
import com.yunglinho.app.service.LocationService

import scala.concurrent.Await
import scala.concurrent.ExecutionContext
import scala.concurrent.Future
import scala.concurrent.duration._
</code></pre></div>
<p>過去我排 import 的慣用法是按 <strong>有授權疑慮</strong> 的順序去排</p>

<ul>
<li>com.* 的在最上面</li>
<li>org, net 排第二</li>
<li> 接著是排自己公司的東西，按 common, base, app 的順序去排，common 跟 based 是放 utilities &amp; framework ， app 就是放一個專案的東西了</li>
<li>最後scala &amp; java 的東西</li>
</ul>

<p>這樣排的好處是， code review 一眼看過去，就可以知道用了那些版權有疑慮的東西，而且 import 時，不會把 java &amp; scala 內建的東西蓋過去，同時也知道這支程式碼用了多少其它的東西</p>

<p>然而，這個機制，在 <strong>Scala&#39;s Type Inference</strong> 的影響下，變的很不可靠。</p>

<p><strong>Type Inference</strong> 是初學 Scala 時，覺得很方便的一個功能，能夠在寫程式時，少打很多的字，例如：</p>
<div class="highlight"><pre><code class="language-" data-lang="">   // 在沒有 Type Inference 下， statement 的左右兩邊都要宣告型態
   val location: Location = new Location("Taipei")

   // 左邊的這邊其實是可以省下的
   val location = new Location("Taipei")

   // 左右兩邊都沒有 *Location* 的存在，但是卻是被引入在這邊了 
   val location = locationService.lookup("Taipei")
</code></pre></div>
<p>這看似方便的功能，卻有著非常深遠且負面的影響，在上面的例子中 <em>Location</em>  這類別，雖然在 import 時沒有出現過，但是卻是在 Reviewer 意料之外中，被帶入到了這程式碼中。</p>

<p>當然，在上面的例子中，<em>Location</em> &amp; <em>LocationService</em> 是一套的觀念，所以沒有真的引入意料之外的 <em>Domain</em> 進來，但是如果今天程式碼寫的不好，是有個 <em>ApplicationContextHolder.getCalendarService</em> 的話，那就不一樣了。</p>

<p>在一行行 code review 時，有可能會抓到這問題，但是如果你沒有空一行行的看呢？或者是你是在 <em>refactor</em> 數千行程式碼時，那要怎樣一行行的去看呢？</p>

<p>所以，設計程式語言真的是很困難，一個看似方便的功能，卻在意料之外的地方造成困擾，讓我最近有點想回去改用 Java 。當然 Scala 還是個很好的語言，能夠幫我增加兩三倍的生產力，不過，卻會讓團隊工作時造成困擾。</p>

  </div>


<!-- Pagination links -->
<div class="pagination">
  
    <span class="previous">Previous</span>
  
  <span class="page_number ">Page: 1 of 6</span>
  
    <a href="/blog/page/2" class="next">Next</a>
  
</div>  

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">碎碎念</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>碎碎念</li>
          <li><a href="mailto:yunglin at gmail.com">yunglin at gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/yunglin"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">yunglin</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/yunglinho"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">yunglinho</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p class="rss-subscribe">subscribe <a href="https://feeds.feedburner.com/yunglinho">via RSS</a></p>
      </div>


    </div>

  </div>

</footer>


  </body>

</html>
